<!doctype html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Asset Inventory</title>
  <link rel="stylesheet" href="./styles.css">
</head>
<body>
  <section class="auth-shell" id="authShell">
    <div class="panel auth-panel" id="authPanel">
      <h2>Sign In</h2>
      <p class="muted">Use email magic link for fast mobile sign-in.</p>
      <div class="grid">
        <div>
          <label for="emailInput">Email</label>
          <input id="emailInput" type="email" placeholder="name@school.org" autocomplete="email">
        </div>
        <button class="btn primary" id="sendLinkBtn">Send Magic Link</button>
      </div>
      <p class="muted" id="authMessage"></p>
    </div>
  </section>

  <div class="app" id="dashboardShell" hidden>
    <aside class="sidebar">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div class="title">
          <strong>IT Asset Inventory</strong>
          <span>Team workspace</span>
        </div>
      </div>

      <nav class="nav" aria-label="Primary" id="mainNav" hidden>
        <a class="active" href="./index.html"><span>Search</span></a>
        <div class="nav-group nav-group-admin" data-role-min="admin">
          <button class="nav-group-toggle" type="button" aria-expanded="false">
            <span>Admin</span>
            <span class="nav-caret" aria-hidden="true">â–¾</span>
          </button>
          <div class="nav-submenu">
            <a class="nav-subitem" href="./admin.html"><span>Asset Management</span></a>
            <a class="nav-subitem" href="./people.html"><span>User Management</span></a>
          </div>
        </div>
        <a href="./reports.html"><span>Reports</span></a>
      </nav>

      <div class="sidebar-footer"></div>
    </aside>

    <main class="main">
      <div class="topbar" id="indexTopbar" hidden>
        <div>
          <h1>Assets</h1>
          <div class="subtext">Search and manage devices.</div>
          <div class="subtext" id="userMeta"></div>
        </div>
        <div class="controls">
          <span class="remote-badge" id="remoteBadge" aria-live="polite">Remote Scanner: Idle</span>
          <button class="btn danger" id="remoteEndBtn" type="button" hidden>End Session</button>
          <button class="bulk-icon-btn remote-scan-btn" id="remoteScanBtn" type="button" aria-label="Pair phone scanner" title="Pair Phone Scanner">
            <svg viewBox="0 0 24 24" aria-hidden="true">
              <rect x="3" y="5" width="10" height="14" rx="2"></rect>
              <path d="M17 8h4"></path>
              <path d="M19 6v4"></path>
              <path d="M8 16h0.01"></path>
            </svg>
          </button>
          <button class="btn" id="signOutBtn" type="button">Log Out</button>
        </div>
      </div>

      <section class="kpis" aria-label="Summary">
        <div class="kpi">
          <div class="label">Total assets</div>
          <div class="value" id="kpiTotal">0</div>
          <div class="hint">All tracked items</div>
        </div>
        <div class="kpi">
          <div class="label">Assigned</div>
          <div class="value" id="kpiAssigned">0</div>
          <div class="hint">Checked out to users</div>
        </div>
        <div class="kpi">
          <div class="label">Available</div>
          <div class="value" id="kpiAvailable">0</div>
          <div class="hint">Ready to deploy</div>
        </div>
        <div class="kpi">
          <div class="label">Needs attention</div>
          <div class="value" id="kpiAttention">0</div>
          <div class="hint">Repair / retired</div>
        </div>
      </section>

      <section class="panel" aria-label="Asset list" id="searchPanel" hidden>
        <div class="panel-header">
          <div class="controls">
            <div class="field search-field" id="searchField">
              <input id="searchInput" type="search" placeholder="Search serial, model, location..." autocomplete="off">
              <button class="bulk-icon-btn search-inline-scan-btn" id="scannerToggleBtn" type="button" aria-label="Start scanner" title="QR Scanner">
                <svg class="icon-scan" viewBox="0 0 24 24" aria-hidden="true">
                  <path d="M4 9V6a2 2 0 0 1 2-2h3" />
                  <path d="M20 9V6a2 2 0 0 0-2-2h-3" />
                  <path d="M4 15v3a2 2 0 0 0 2 2h3" />
                  <path d="M20 15v3a2 2 0 0 1-2 2h-3" />
                  <path d="M5 12h14" />
                </svg>
                <svg class="icon-stop" viewBox="0 0 24 24" aria-hidden="true">
                  <rect x="7" y="7" width="10" height="10" rx="1.5" />
                </svg>
              </button>
              <div class="scanner-stage" id="scannerStage" hidden>
                <video id="scannerVideo" autoplay playsinline muted></video>
                <canvas id="scannerCanvas" hidden></canvas>
                <div class="scanner-overlay"></div>
                <div class="scanner-hint" id="searchScannerHint">Scan QR/barcode to search</div>
              </div>
            </div>
            <div class="field small">
              <select id="statusFilter">
                <option value="">All status</option>
                <option value="available">Available</option>
                <option value="checked_out">Checked Out</option>
                <option value="repair">Repair</option>
                <option value="retired">Retired</option>
              </select>
            </div>
          </div>

          <div class="controls">
            <button class="btn" id="clearFiltersBtn" type="button">Clear</button>
          </div>
        </div>

        <div class="table-wrap">
          <table role="grid" aria-label="Assets table">
            <thead>
              <tr>
                <th>Serial</th>
                <th>Model</th>
                <th>Assigned To</th>
                <th>Status</th>
                <th>Location</th>
              </tr>
            </thead>
            <tbody id="assetTbody"></tbody>
          </table>
        </div>
      </section>
    </main>
  </div>

  <div class="drawer-overlay" id="drawerOverlay"></div>
  <aside class="drawer" id="drawer" aria-label="Asset details" aria-hidden="true">
    <div class="drawer-header">
      <div class="drawer-title">
        <strong id="drawerPrimary">-</strong>
        <span id="drawerSecondary">-</span>
      </div>
      <button class="btn ghost" id="closeDrawerBtn" type="button" aria-label="Close details">X</button>
    </div>
    <div class="drawer-body">
      <div class="detail-grid" id="drawerDetails"></div>
      <div class="detail">
        <div class="k">Notes</div>
        <div class="v" id="drawerNotes">-</div>
      </div>
      <div class="detail" id="drawerAssigneeEditor" hidden>
        <div class="k">Change Assignee</div>
        <div class="v">
          <input id="drawerAssigneeSearch" type="search" placeholder="Type person name...">
          <div id="drawerAssigneeSuggestions" class="suggestions" hidden></div>
          <div class="muted" id="drawerAssigneeSelected">No assignee selected</div>
          <div class="row">
            <button class="btn" id="drawerSetAssigneeBtn" type="button">Set Assignee</button>
            <button class="btn" id="drawerCreatePersonBtn" type="button" hidden>Create Person</button>
          </div>
        </div>
      </div>
    </div>
    <div class="drawer-footer">
      <button class="btn primary" id="printLabelBtn" type="button">Print Label</button>
      <button class="btn" id="editBtn" type="button">Edit</button>
      <button class="btn danger" id="retireBtn" type="button">Retire</button>
    </div>
  </aside>

  <div class="toast" id="toast" role="status" aria-live="polite"></div>

  <div class="pair-modal-overlay" id="pairModalOverlay" hidden></div>
  <section class="pair-modal" id="pairModal" hidden aria-label="Phone scanner pairing">
    <div class="pair-modal-head">
      <strong>Pair Phone Scanner</strong>
      <button class="btn ghost" id="pairModalCloseBtn" type="button" aria-label="Close pairing">X</button>
    </div>
    <div class="pair-modal-body">
      <div class="muted">Open <code>pair.html</code> on the shared phone, then scan this QR.</div>
      <canvas id="pairQrCanvas" width="220" height="220" aria-label="Pairing QR"></canvas>
      <div class="pair-status" id="pairStatus">Waiting to generate pairing...</div>
      <div class="pair-meta muted" id="pairMeta"></div>
    </div>
    <div class="pair-modal-footer">
      <button class="btn" id="pairEndSessionBtn" type="button">Cancel</button>
      <button class="btn primary" id="pairRegenerateBtn" type="button">Regenerate QR</button>
    </div>
  </section>

  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.4/build/qrcode.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>
  <script src="./config.js"></script>
  <script src="./ui.js"></script>
  <script type="module" src="./js/index.js"></script>
  <button class="theme-toggle-fab" id="themeBtn" type="button" aria-label="Toggle theme">
    <span class="theme-toggle-glyph" aria-hidden="true"></span>
  </button>
</body>
</html>

