<!doctype html>
<html lang="en" data-theme="light">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" href="./favicon.svg" type="image/svg+xml">
  <link rel="apple-touch-icon" href="./apple-touch-icon.png">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline'; img-src 'self' data: blob: https://api.qrserver.com https://*.supabase.co; connect-src 'self' https://*.supabase.co; font-src 'self' data:; media-src 'self' blob:; object-src 'none'; base-uri 'self'; frame-ancestors 'none'; upgrade-insecure-requests">
  <meta name="referrer" content="strict-origin-when-cross-origin">
  <title>Phone Scanner Pairing</title>
  <link rel="stylesheet" href="./styles.css">
</head>
<body>
  <main class="main" style="padding:14px;max-width:760px;margin:0 auto;">
    <section class="panel">
      <div class="panel-body">
        <h2>Shared Phone Scanner</h2>
        <p class="muted">Scan the desktop pairing QR first, then scan barcodes.</p>
        <div class="row pair-actions">
          <button class="btn primary" id="pairStartBtn" type="button">Pair QR Scanner</button>
          <button class="btn" id="scanStartBtn" type="button" hidden>Start Scanning</button>
          <button class="btn" id="scanPauseBtn" type="button" disabled>Pause Scanning</button>
          <button class="btn danger" id="scanEndSessionBtn" type="button" hidden disabled>End Session</button>
        </div>
        <div class="detail" style="margin-top:10px;">
          <div class="k">Session</div>
          <div class="v pair-session-line">
            <span id="pairState">Session: Not paired</span>
            <span class="muted" id="pairCountdown">--:-- remaining</span>
          </div>
        </div>
        <div class="scanner-stage pair-scanner-stage" id="pairScannerStage" hidden>
          <video id="pairScannerVideo" autoplay playsinline muted></video>
          <canvas id="pairScannerFreeze" class="scanner-freeze-canvas" hidden aria-hidden="true"></canvas>
          <canvas id="pairScannerOverlay" class="scanner-guide-canvas" aria-hidden="true"></canvas>
          <canvas id="pairScannerCanvas" hidden></canvas>
          <div class="scanner-overlay"></div>
          <div class="pair-last-pill" id="pairLastScanPill" hidden>Last: -</div>
        </div>
        <div class="muted" id="pairHint">Tap "Scan Pair QR" and point camera at the desktop pairing code.</div>
      </div>
    </section>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>
  <script src="./config.js"></script>
  <script type="module" src="./js/pair.js"></script>
</body>
</html>
